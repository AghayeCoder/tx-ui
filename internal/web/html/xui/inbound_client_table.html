{{define "client_table"}}
<template slot="actions" slot-scope="text, client, index">
    <a-tooltip>
        <template slot="title">{{ i18n "qrCode" }}</template>
        <a-icon @click="showQrcode(record.id,client);" class="normal-icon" style="font-size: 24px;" type="qrcode"
                v-if="record.hasLink()"></a-icon>
    </a-tooltip>
    <a-tooltip>
        <template slot="title">{{ i18n "pages.client.edit" }}</template>
        <a-icon @click="openEditClient(record.id,client);" class="normal-icon" style="font-size: 24px;"
                type="edit"></a-icon>
    </a-tooltip>
    <a-tooltip>
        <template slot="title">{{ i18n "info" }}</template>
        <a-icon @click="showInfo(record.id,client);" class="normal-icon" style="font-size: 24px;"
                type="info-circle"></a-icon>
    </a-tooltip>
    <a-tooltip>
        <template slot="title">{{ i18n "pages.inbounds.resetTraffic" }}</template>
        <a-popconfirm :overlay-class-name="themeSwitcher.currentTheme"
                      @confirm="resetClientTraffic(client,record.id,false)"
                      cancel-text='{{ i18n "cancel"}}' ok-text='{{ i18n "reset"}}'
                      title='{{ i18n "pages.inbounds.resetTrafficContent"}}'>
            <a-icon :style="themeSwitcher.isDarkTheme ? 'color: var(--color-primary-100)' : 'color: var(--color-primary-100)'" slot="icon"
                    type="question-circle-o"></a-icon>
            <a-icon class="normal-icon" style="font-size: 24px; cursor: pointer;" type="retweet"
                    v-if="client.email.length > 0"></a-icon>
        </a-popconfirm>
    </a-tooltip>
    <a-tooltip>
        <template slot="title">
            <span style="color: #FF4D4F"> {{ i18n "delete"}}</span>
        </template>
        <a-popconfirm :overlay-class-name="themeSwitcher.currentTheme"
                      @confirm="delClient(record.id,client,false)"
                      cancel-text='{{ i18n "cancel"}}' ok-text='{{ i18n "delete"}}' ok-type="danger"
                      title='{{ i18n "pages.inbounds.deleteClientContent"}}'>
            <a-icon slot="icon" style="color: #e04141" type="question-circle-o"></a-icon>
            <a-icon class="delete-icon" style="font-size: 24px; cursor: pointer;" type="delete"
                    v-if="isRemovable(record.id)"></a-icon>
        </a-popconfirm>
    </a-tooltip>
</template>
<template slot="enable" slot-scope="text, client, index">
    <a-switch @change="switchEnableClient(record.id,client)" v-model="client.enable"></a-switch>
</template>
<template slot="online" slot-scope="text, client, index">
    <template v-if="client.enable && isClientOnline(client.email)">
        <a-tag color="green">{{ i18n "online" }}</a-tag>
    </template>
    <template v-else>
        <a-tag>{{ i18n "offline" }}</a-tag>
    </template>
</template>
<template slot="client" slot-scope="text, client">
    <a-tooltip>
        <template slot="title">
            <template v-if="!isClientEnabled(record, client.email)">{{ i18n "depleted" }}</template>
            <template v-else-if="!client.enable">{{ i18n "disabled" }}</template>
            <template v-else-if="client.enable && isClientOnline(client.email)">{{ i18n "online" }}</template>
        </template>
        <a-badge :class="isClientOnline(client.email)? 'online-animation' : ''"
                 :color="client.enable ? statsExpColor(record, client.email) : themeSwitcher.isDarkTheme ? '#2c3950' : '#bcbcbc'"></a-badge>
    </a-tooltip>
    [[ client.email ]]
</template>
<template slot="traffic" slot-scope="text, client">
    <a-popover :overlay-class-name="themeSwitcher.currentTheme">
        <template slot="content" v-if="client.email">
            <table cellpadding="2" width="100%">
                <tr>
                    <td>↑[[ sizeFormat(getUpStats(record, client.email)) ]]</td>
                    <td>↓[[ sizeFormat(getDownStats(record, client.email)) ]]</td>
                </tr>
                <tr v-if="client.totalGB > 0">
                    <td>{{ i18n "remained" }}</td>
                    <td>[[ sizeFormat(getRemStats(record, client.email)) ]]</td>
                </tr>
            </table>
        </template>
        <table>
            <tr class="tr-table-box">
                <td class="tr-table-rt"> [[ sizeFormat(getSumStats(record, client.email)) ]]</td>
                <td class="tr-table-bar" v-if="!client.enable">
                    <a-progress :percent="statsProgress(record, client.email)"
                                :show-info="false" :stroke-color="themeSwitcher.isDarkTheme ? 'rgb(72 84 105)' : '#bcbcbc'"/>
                </td>
                <td class="tr-table-bar" v-else-if="client.totalGB > 0">
                    <a-progress :percent="statsProgress(record, client.email)" :show-info="false"
                                :status="isClientEnabled(record, client.email)? 'exception' : ''"
                                :stroke-color="clientStatsColor(record, client.email)"/>
                </td>
                <td class="infinite-bar tr-table-bar" v-else>
                    <a-progress :percent="100" :show-info="false"></a-progress>
                </td>
                <td class="tr-table-lt">
                    <template v-if="client.totalGB > 0">[[ client._totalGB + "GB" ]]</template>
                    <span class="tr-infinity-ch" v-else>&infin;</span>
                </td>
            </tr>
        </table>
    </a-popover>
</template>
<template slot="expiryTime" slot-scope="text, client, index">
    <template v-if="client.expiryTime !=0 && client.reset >0">
        <a-popover :overlay-class-name="themeSwitcher.currentTheme">
            <template slot="content">
        <span v-if="client.expiryTime < 0">{{ i18n "pages.client.delayedStart" }}
        </span>
                <span v-else>
          <template v-if="app.datepicker === 'gregorian'">
            [[ DateUtil.formatMillis(client._expiryTime) ]]
          </template>
          <template v-else>
            [[ DateUtil.convertToJalalian(moment(client._expiryTime)) ]]
          </template>
        </span>
            </template>
            <table>
                <tr class="tr-table-box">
                    <td class="tr-table-rt"> [[ remainedDays(client.expiryTime) ]]</td>
                    <td class="infinite-bar tr-table-bar">
                        <a-progress :percent="expireProgress(client.expiryTime, client.reset)" :show-info="false"
                                    :status="isClientEnabled(record, client.email)? 'exception' : ''"/>
                    </td>
                    <td class="tr-table-lt">[[ client.reset + "d" ]]</td>
                </tr>
            </table>
        </a-popover>
    </template>
    <template v-else>
        <a-popover :overlay-class-name="themeSwitcher.currentTheme" v-if="client.expiryTime != 0">
            <template slot="content">
        <span v-if="client.expiryTime < 0">{{ i18n "pages.client.delayedStart" }}
        </span>
                <span v-else>
          <template v-if="app.datepicker === 'gregorian'">
            [[ DateUtil.formatMillis(client._expiryTime) ]]
          </template>
          <template v-else>
            [[ DateUtil.convertToJalalian(moment(client._expiryTime)) ]]
          </template>
        </span>
            </template>
            <a-tag :color="userExpiryColor(app.expireDiff, client, themeSwitcher.isDarkTheme)"
                   style="min-width: 50px; border: none;"> [[
                remainedDays(client.expiryTime) ]]
            </a-tag>
        </a-popover>
        <a-tag :color="userExpiryColor(app.expireDiff, client, themeSwitcher.isDarkTheme)" class="infinite-tag" style="border: none;"
               v-else>
            <svg fill="currentColor" height="10px" viewBox="0 0 640 512" width="14px">
                <path d="M484.4 96C407 96 349.2 164.1 320 208.5C290.8 164.1 233 96 155.6 96C69.75 96 0 167.8 0 256s69.75 160 155.6 160C233.1 416 290.8 347.9 320 303.5C349.2 347.9 407 416 484.4 416C570.3 416 640 344.2 640 256S570.3 96 484.4 96zM155.6 368C96.25 368 48 317.8 48 256s48.25-112 107.6-112c67.75 0 120.5 82.25 137.1 112C276 285.8 223.4 368 155.6 368zM484.4 368c-67.75 0-120.5-82.25-137.1-112C364 226.2 416.6 144 484.4 144C543.8 144 592 194.2 592 256S543.8 368 484.4 368z"
                      fill="currentColor"></path>
            </svg>
        </a-tag>
    </template>
</template>
<template slot="actionMenu" slot-scope="text, client, index">
    <a-dropdown :trigger="['click']">
        <a-icon @click="e => e.preventDefault()" style="font-size: 20px;" type="ellipsis"></a-icon>
        <a-menu :theme="themeSwitcher.currentTheme" slot="overlay">
            <a-menu-item @click="showQrcode(record.id,client);" v-if="record.hasLink()">
                <a-icon style="font-size: 14px;" type="qrcode"></a-icon>
                {{ i18n "qrCode" }}
            </a-menu-item>
            <a-menu-item @click="openEditClient(record.id,client);">
                <a-icon style="font-size: 14px;" type="edit"></a-icon>
                {{ i18n "pages.client.edit" }}
            </a-menu-item>
            <a-menu-item @click="showInfo(record.id,client);">
                <a-icon style="font-size: 14px;" type="info-circle"></a-icon>
                {{ i18n "info" }}
            </a-menu-item>
            <a-menu-item @click="resetClientTraffic(client,record.id)" v-if="client.email.length > 0">
                <a-icon style="font-size: 14px;" type="retweet"></a-icon>
                {{ i18n "pages.inbounds.resetTraffic" }}
            </a-menu-item>
            <a-menu-item @click="delClient(record.id,client)" v-if="isRemovable(record.id)">
                <a-icon style="font-size: 14px;" type="delete"></a-icon>
                <span style="color: #FF4D4F"> {{ i18n "delete"}}</span>
            </a-menu-item>
            <a-menu-item>
                <a-switch @change="switchEnableClient(record.id,client)" size="small"
                          v-model="client.enable"></a-switch>
                {{ i18n "enable"}}
            </a-menu-item>
        </a-menu>
    </a-dropdown>
</template>
<template slot="info" slot-scope="text, client, index">
    <a-popover :overlay-class-name="themeSwitcher.currentTheme" placement="bottomRight" trigger="click">
        <template slot="content">
            <table>
                <tr>
                    <td colspan="3" style="text-align: center;">{{ i18n "pages.inbounds.traffic" }}</td>
                </tr>
                <tr>
                    <td style="margin:0; text-align: right;font-size: 1em;" width="80px"> [[
                        sizeFormat(getUpStats(record, client.email) + getDownStats(record, client.email)) ]]
                    </td>
                    <td v-if="!client.enable" width="120px">
                        <a-progress :percent="statsProgress(record, client.email)"
                                    :show-info="false" :stroke-color="themeSwitcher.isDarkTheme ? 'rgb(72 84 105)' : '#bcbcbc'"/>
                    </td>
                    <td v-else-if="client.totalGB > 0" width="120px">
                        <a-popover :overlay-class-name="themeSwitcher.currentTheme">
                            <template slot="content" v-if="client.email">
                                <table cellpadding="2" width="100%">
                                    <tr>
                                        <td>↑[[ sizeFormat(getUpStats(record, client.email)) ]]</td>
                                        <td>↓[[ sizeFormat(getDownStats(record, client.email)) ]]</td>
                                    </tr>
                                    <tr>
                                        <td>{{ i18n "remained" }}</td>
                                        <td>[[ sizeFormat(getRemStats(record, client.email)) ]]</td>
                                    </tr>
                                </table>
                            </template>
                            <a-progress :percent="statsProgress(record, client.email)" :show-info="false"
                                        :status="isClientEnabled(record, client.email)? 'exception' : ''"
                                        :stroke-color="clientStatsColor(record, client.email)"/>
                        </a-popover>
                    </td>
                    <td class="infinite-bar" v-else width="120px">
                        <a-progress :percent="100" :show-info="false"
                                    :stroke-color="themeSwitcher.isDarkTheme ? '#2c1e32':'#F2EAF1'"></a-progress>
                    </td>
                    <td width="80px">
                        <template v-if="client.totalGB > 0">[[ client._totalGB + "GB" ]]</template>
                        <span class="tr-infinity-ch" v-else>&infin;</span>
                    </td>
                </tr>
                <tr>
                    <td colspan="3" style="text-align: center;">
                        <a-divider style="margin: 0; border-collapse: separate;"></a-divider>
                        {{ i18n "pages.inbounds.expireDate" }}
                    </td>
                </tr>
                <tr>
                    <template v-if="client.expiryTime !=0 && client.reset >0">
                        <td style="margin:0; text-align: right;font-size: 1em;" width="80px"> [[
                            remainedDays(client.expiryTime) ]]
                        </td>
                        <td class="infinite-bar" width="120px">
                            <a-popover :overlay-class-name="themeSwitcher.currentTheme">
                                <template slot="content">
                  <span v-if="client.expiryTime < 0">{{ i18n "pages.client.delayedStart" }}
                  </span>
                                    <span v-else>
                    <template v-if="app.datepicker === 'gregorian'">
                      [[ DateUtil.formatMillis(client._expiryTime) ]]
                    </template>
                    <template v-else>
                      [[ DateUtil.convertToJalalian(moment(client._expiryTime)) ]]
                    </template>
                  </span>
                                </template>
                                <a-progress :percent="expireProgress(client.expiryTime, client.reset)"
                                            :show-info="false"
                                            :status="isClientEnabled(record, client.email)? 'exception' : ''"/>
                            </a-popover>
                        </td>
                        <td width="60px">[[ client.reset + "d" ]]</td>
                    </template>
                    <template v-else>
                        <td colspan="3" style="text-align: center;">
                            <a-popover :overlay-class-name="themeSwitcher.currentTheme" v-if="client.expiryTime != 0">
                                <template slot="content">
                  <span v-if="client.expiryTime < 0">{{ i18n "pages.client.delayedStart" }}
                  </span>
                                    <span v-else>
                    <template v-if="app.datepicker === 'gregorian'">
                      [[ DateUtil.formatMillis(client._expiryTime) ]]
                    </template>
                    <template v-else>
                      [[ DateUtil.convertToJalalian(moment(client._expiryTime)) ]]
                    </template>
                  </span>
                                </template>
                                <a-tag :color="userExpiryColor(app.expireDiff, client, themeSwitcher.isDarkTheme)"
                                       style="min-width: 50px; border: none;"> [[
                                    remainedDays(client.expiryTime) ]]
                                </a-tag>
                            </a-popover>
                            <a-tag :color="client.enable ? 'purple' : themeSwitcher.isDarkTheme ? '#2c3950' : '#bcbcbc'"
                                   class="infinite-tag"
                                   v-else>
                                <svg fill="currentColor" height="10px" viewBox="0 0 640 512" width="14px">
                                    <path d="M484.4 96C407 96 349.2 164.1 320 208.5C290.8 164.1 233 96 155.6 96C69.75 96 0 167.8 0 256s69.75 160 155.6 160C233.1 416 290.8 347.9 320 303.5C349.2 347.9 407 416 484.4 416C570.3 416 640 344.2 640 256S570.3 96 484.4 96zM155.6 368C96.25 368 48 317.8 48 256s48.25-112 107.6-112c67.75 0 120.5 82.25 137.1 112C276 285.8 223.4 368 155.6 368zM484.4 368c-67.75 0-120.5-82.25-137.1-112C364 226.2 416.6 144 484.4 144C543.8 144 592 194.2 592 256S543.8 368 484.4 368z"
                                          fill="currentColor"></path>
                                </svg>
                            </a-tag>
                    </template>
                    </td>
                </tr>
            </table>
        </template>
        <a-badge>
            <a-icon :style="'color: ' + themeSwitcher.isDarkTheme ? '#2c3950' : '#bcbcbc'" slot="count" theme="filled" type="pause-circle"
                    v-if="!client.enable"></a-icon>
            <a-button shape="round" size="small" style="font-size: 14px; padding: 0 10px;">
                <a-icon type="solution"></a-icon>
            </a-button>
        </a-badge>
    </a-popover>
</template>
{{end}}
