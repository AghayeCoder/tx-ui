{{define "form/streamFinalMask"}}
<a-divider :style="{ margin: '5px 0 0' }"></a-divider>
<a-form :colon="false" :label-col="{ md: {span:8} }"
        :wrapper-col="{ md: {span:14} }">
    <a-form-item label="UDP Masks">
        <a-button @click="inbound.stream.addUdpMask(inbound.stream.network === 'kcp' ? 'mkcp-aes128gcm' : 'xdns')" icon="plus" size="small"
                  type="primary"></a-button>
    </a-form-item>
    <template
            v-if="inbound.stream.finalmask.udp && inbound.stream.finalmask.udp.length > 0">
        <a-form :colon="false"
                :key="index" :label-col="{ md: {span:8} }"
                :wrapper-col="{ md: {span:14} }" v-for="(mask, index) in inbound.stream.finalmask.udp">
            <a-divider :style="{ margin: '0' }"> UDP Mask [[ index + 1 ]]
                <a-icon :style="{ color: 'rgb(255, 77, 79)', cursor: 'pointer' }"
                        @click="() => inbound.stream.delUdpMask(index)"
                        type="delete"></a-icon>
            </a-divider>
            <a-form-item label='Type'>
                <a-select :dropdown-class-name="themeSwitcher.currentTheme"
                          @change="(type) => mask.settings = mask._getDefaultSettings(type, {})"
                          v-model="mask.type">
                    <!-- mKCP-specific masks -->
                    <a-select-option v-if="inbound.stream.network === 'kcp'"
                                     value="mkcp-aes128gcm">
                        mKCP AES-128-GCM
                    </a-select-option>
                    <a-select-option v-if="inbound.stream.network === 'kcp'"
                                     value="header-dns">
                        Header DNS
                    </a-select-option>
                    <a-select-option v-if="inbound.stream.network === 'kcp'"
                                     value="header-dtls">
                        Header DTLS 1.2
                    </a-select-option>
                    <a-select-option v-if="inbound.stream.network === 'kcp'"
                                     value="header-srtp">
                        Header SRTP
                    </a-select-option>
                    <a-select-option v-if="inbound.stream.network === 'kcp'"
                                     value="header-utp">
                        Header uTP
                    </a-select-option>
                    <a-select-option v-if="inbound.stream.network === 'kcp'"
                                     value="header-wechat">
                        Header WeChat Video
                    </a-select-option>
                    <a-select-option v-if="inbound.stream.network === 'kcp'"
                                     value="header-wireguard">
                        Header WireGuard
                    </a-select-option>
                    <a-select-option v-if="inbound.stream.network === 'kcp'"
                                     value="mkcp-original">
                        mKCP Original
                    </a-select-option>
                    <a-select-option v-if="inbound.stream.network === 'kcp'"
                                     value="xicmp">
                        xICMP (Experimental)
                    </a-select-option>
                    <!-- xDNS for TCP/WS/HTTPUpgrade/XHTTP -->
                    <a-select-option
                            v-if="['tcp', 'ws', 'httpupgrade', 'xhttp'].includes(inbound.stream.network)"
                            value="xdns">
                        xDNS (Experimental)
                    </a-select-option>
                </a-select>
            </a-form-item>
            <!-- Settings for password-based masks -->
            <a-form-item label='Password'
                         v-if="['mkcp-aes128gcm'].includes(mask.type)">
                <a-input placeholder="Obfuscation password"
                         v-model.trim="mask.settings.password"></a-input>
            </a-form-item>
            <!-- Settings for domain-based masks -->
            <a-form-item label='Domain'
                         v-if="['header-dns', 'xdns'].includes(mask.type)">
                <a-input placeholder="e.g., www.example.com"
                         v-model.trim="mask.settings.domain"></a-input>
            </a-form-item>
            <!-- Settings for xICMP -->
            <a-form-item label='IP'
                         v-if="mask.type === 'xicmp'">
                <a-input placeholder="e.g., 1.1.1.1"
                         v-model.trim="mask.settings.ip"></a-input>
            </a-form-item>
            <a-form-item label='ID'
                         v-if="mask.type === 'xicmp'">
                <a-input-number :max="65535"
                                :min="0" v-model.number="mask.settings.id"></a-input-number>
            </a-form-item>
        </a-form>
    </template>
</a-form>
{{end}}
